/**
 * EpicEditor - An Embeddable JavaScript Markdown Editor (https://github.com/OscarGodson/EpicEditor)
 * Copyright (c) 2011-2012, Oscar Godson. (MIT Licensed)
 */(function(a,b){function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function d(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])}function e(b,c){var d=b,e=null;return a.getComputedStyle?e=document.defaultView.getComputedStyle(d,null).getPropertyValue(c):d.currentStyle&&(e=d.currentStyle[c]),e}function f(a,b,c){var f={},g;if(b==="save"){for(g in c)c.hasOwnProperty(g)&&(f[g]=e(a,g));d(a,c)}else b==="apply"&&d(a,c);return f}function g(a){var b=parseInt(e(a,"border-left-width"),10)+parseInt(e(a,"border-right-width"),10),c=parseInt(e(a,"padding-left"),10)+parseInt(e(a,"padding-right"),10),d=a.offsetWidth,f;return isNaN(b)&&(b=0),f=b+c+d,f}function h(a){var b=parseInt(e(a,"border-top-width"),10)+parseInt(e(a,"border-bottom-width"),10),c=parseInt(e(a,"padding-top"),10)+parseInt(e(a,"padding-bottom"),10),d=a.offsetHeight,f;return isNaN(b)&&(b=0),f=b+c+d,f}function i(a,b,d){d=d||"";var e=b.getElementsByTagName("head")[0],f=b.createElement("link");c(f,{type:"text/css",id:d,rel:"stylesheet",href:a+"?"+(new Date).getTime(),name:a,media:"screen"}),e.appendChild(f)}function j(a,b,c){a.className=a.className.replace(b,c)}function k(a){return a.contentDocument||a.contentWindow.document}function l(a){var b;return document.body.innerText?b=a.innerText:b=a.innerHTML.replace(/<br>/gi,"\n"),b}function m(a,b){return document.body.innerText?a.innerText=b:a.innerHTML=b.replace(/\n/g,"<br>"),!0}function n(){var a=-1,b=navigator.userAgent,c;return navigator.appName=="Microsoft Internet Explorer"&&(c=/MSIE ([0-9]{1,}[\.0-9]{0,})/,c.exec(b)!=null&&(a=parseFloat(RegExp.$1,10))),a}function o(a){var b={};return a&&b.toString.call(a)==="[object Function]"}function p(){var a=arguments[0]||{},c=1,d=arguments.length,e=!1,f,g,h,i;typeof a=="boolean"&&(e=a,a=arguments[1]||{},c=2),typeof a!="object"&&!o(a)&&(a={}),d===c&&(a=this,--c);for(;c<d;c++)if((f=arguments[c])!=null)for(g in f)if(f.hasOwnProperty(g)){h=a[g],i=f[g];if(a===i)continue;e&&i&&typeof i=="object"&&!i.nodeType?a[g]=p(e,h||(i.length!=null?[]:{}),i):i!==b&&(a[g]=i)}return a}function q(a){var b=a||{},c={container:"epiceditor",basePath:"epiceditor",localStorageName:"epiceditor",file:{name:b.container||"epiceditor",defaultContent:"",autoSave:100},theme:{base:"/themes/base/epiceditor.css",preview:"/themes/preview/github.css",editor:"/themes/editor/epic-dark.css"},focusOnLoad:!1,shortcut:{modifier:18,fullscreen:70,preview:80,edit:79}},d;return this.settings=p(!0,c,b),this.settings.id="epiceditor-"+Math.round(Math.random()*1e5),localStorage&&(localStorage[this.settings.localStorageName]?JSON.parse(localStorage[this.settings.localStorageName]).files[this.settings.file.name]?this.content=this.settings.file.defaultContent:JSON.parse(localStorage[this.settings.localStorageName]).files[this.settings.file.name]=this.settings.file.defaultContent:(d={files:{}},d.files[this.settings.file.name]=this.settings.file.defaultContent,d=JSON.stringify(d),localStorage[this.settings.localStorageName]=d)),this.events||(this.events={}),this.element=document.getElementById(this.settings.container),this}(function(){function l(){var a="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+";return a}function m(a){return a=a.source,function b(c,d){return c?(a=a.replace(c,d.source||d),b):new RegExp(a)}}function n(){}var a={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:n,hr:/^( *[\-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)([*+-]|\d+\.) [^\0]+?(?:\n{2,}(?! )(?!\1bullet)\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *([^\s]+)(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,paragraph:/^([^\n]+\n?(?!body))+\n*/,text:/^[^\n]+/};a.list=m(a.list)("bullet",/(?:[*+-](?!(?: *[-*]){2,})|\d+\.)/)(),a.html=m(a.html)("comment",/<!--[^\0]*?-->/)("closed",/<(tag)[^\0]+?<\/\1>/)("closing",/<tag(?!:\/|@)\b(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,l())(),a.paragraph=function(){var b=a.paragraph.source,c=[];return function d(b){return b=a[b]?a[b].source:b,c.push(b.replace(/(^|[^\[])\^/g,"$1")),d}("hr")("heading")("lheading")("blockquote")("<"+l())("def"),new RegExp(b.replace("body",c.join("|")))}(),a.normal={fences:a.fences,paragraph:a.paragraph},a.gfm={fences:/^ *``` *(\w+)? *\n([^\0]+?)\s*``` *(?:\n+|$)/,paragraph:/^/},a.gfm.paragraph=m(a.paragraph)("(?!","(?!"+a.gfm.fences.source.replace(/(^|[^\[])\^/g,"$1")+"|")(),a.lexer=function(b){var c=[];return c.links={},b=b.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    "),a.token(b,c,!0)},a.token=function(b,c,d){var b=b.replace(/^ +$/gm,""),e,f,g,h,i,j,k;while(b){if(g=a.newline.exec(b))b=b.substring(g[0].length),g[0].length>1&&c.push({type:"space"});if(g=a.code.exec(b)){b=b.substring(g[0].length),g=g[0].replace(/^ {4}/gm,""),c.push({type:"code",text:p.pedantic?g:g.replace(/\n+$/,"")});continue}if(g=a.fences.exec(b)){b=b.substring(g[0].length),c.push({type:"code",lang:g[1],text:g[2]});continue}if(g=a.heading.exec(b)){b=b.substring(g[0].length),c.push({type:"heading",depth:g[1].length,text:g[2]});continue}if(g=a.lheading.exec(b)){b=b.substring(g[0].length),c.push({type:"heading",depth:g[2]==="="?1:2,text:g[1]});continue}if(g=a.hr.exec(b)){b=b.substring(g[0].length),c.push({type:"hr"});continue}if(g=a.blockquote.exec(b)){b=b.substring(g[0].length),c.push({type:"blockquote_start"}),g=g[0].replace(/^ *> ?/gm,""),a.token(g,c,d),c.push({type:"blockquote_end"});continue}if(g=a.list.exec(b)){b=b.substring(g[0].length),c.push({type:"list_start",ordered:isFinite(g[2])}),g=g[0].match(/^( *)([*+-]|\d+\.) [^\n]*(?:\n(?!\1(?:[*+-]|\d+\.) )[^\n]*)*/gm),e=!1,k=g.length,j=0;for(;j<k;j++)h=g[j],i=h.length,h=h.replace(/^ *([*+-]|\d+\.) +/,""),~h.indexOf("\n ")&&(i-=h.length,h=p.pedantic?h.replace(/^ {1,4}/gm,""):h.replace(new RegExp("^ {1,"+i+"}","gm"),"")),f=e||/\n\n(?!\s*$)/.test(h),j!==k-1&&(e=h[h.length-1]==="\n",f||(f=e)),c.push({type:f?"loose_item_start":"list_item_start"}),a.token(h,c),c.push({type:"list_item_end"});c.push({type:"list_end"});continue}if(g=a.html.exec(b)){b=b.substring(g[0].length),c.push({type:"html",pre:g[1]==="pre",text:g[0]});continue}if(d&&(g=a.def.exec(b))){b=b.substring(g[0].length),c.links[g[1].toLowerCase()]={href:g[2],title:g[3]};continue}if(d&&(g=a.paragraph.exec(b))){b=b.substring(g[0].length),c.push({type:"paragraph",text:g[0]});continue}if(g=a.text.exec(b)){b=b.substring(g[0].length),c.push({type:"text",text:g[0]});continue}}return c};var b={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:n,tag:/^<!--[^\0]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([^\0]+?)__(?!_)|^\*\*([^\0]+?)\*\*(?!\*)/,em:/^\b_((?:__|[^\0])+?)_\b|^\*((?:\*\*|[^\0])+?)\*(?!\*)/,code:/^(`+)([^\0]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,text:/^[^\0]+?(?=[\\<!\[_*`]| {2,}\n|$)/};b._linkInside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/,b._linkHref=/\s*<?([^\s]*?)>?(?:\s+['"]([^\0]*?)['"])?\s*/,b.link=m(b.link)("inside",b._linkInside)("href",b._linkHref)(),b.reflink=m(b.reflink)("inside",b._linkInside)(),b.normal={url:b.url,strong:b.strong,em:b.em,text:b.text},b.pedantic={strong:/^__(?=\S)([^\0]*?\S)__(?!_)|^\*\*(?=\S)([^\0]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([^\0]*?\S)_(?!_)|^\*(?=\S)([^\0]*?\S)\*(?!\*)/},b.gfm={url:/^(https?:\/\/[^\s]+[^.,:;"')\]\s])/,text:/^[^\0]+?(?=[\\<!\[_*`]|https?:\/\/| {2,}\n|$)/},b.lexer=function(a){var e="",f=d.links,g,h,i,l;while(a){if(l=b.escape.exec(a)){a=a.substring(l[0].length),e+=l[1];continue}if(l=b.autolink.exec(a)){a=a.substring(l[0].length),l[2]==="@"?(h=l[1][6]===":"?k(l[1].substring(7)):k(l[1]),i=k("mailto:")+h):(h=j(l[1]),i=h),e+='<a href="'+i+'">'+h+"</a>";continue}if(l=b.url.exec(a)){a=a.substring(l[0].length),h=j(l[1]),i=h,e+='<a href="'+i+'">'+h+"</a>";continue}if(l=b.tag.exec(a)){a=a.substring(l[0].length),e+=p.sanitize?j(l[0]):l[0];continue}if(l=b.link.exec(a)){a=a.substring(l[0].length),e+=c(l,{href:l[2],title:l[3]});continue}if((l=b.reflink.exec(a))||(l=b.nolink.exec(a))){a=a.substring(l[0].length),g=(l[2]||l[1]).replace(/\s+/g," "),g=f[g.toLowerCase()];if(!g||!g.href){e+=l[0][0],a=l[0].substring(1)+a;continue}e+=c(l,g);continue}if(l=b.strong.exec(a)){a=a.substring(l[0].length),e+="<strong>"+b.lexer(l[2]||l[1])+"</strong>";continue}if(l=b.em.exec(a)){a=a.substring(l[0].length),e+="<em>"+b.lexer(l[2]||l[1])+"</em>";continue}if(l=b.code.exec(a)){a=a.substring(l[0].length),e+="<code>"+j(l[2],!0)+"</code>";continue}if(l=b.br.exec(a)){a=a.substring(l[0].length),e+="<br>";continue}if(l=b.text.exec(a)){a=a.substring(l[0].length),e+=j(l[0]);continue}}return e};var c=function(a,c){return a[0][0]!=="!"?'<a href="'+j(c.href)+'"'+(c.title?' title="'+j(c.title)+'"':"")+">"+b.lexer(a[1])+"</a>":'<img src="'+j(c.href)+'" alt="'+j(a[1])+'"'+(c.title?' title="'+j(c.title)+'"':"")+">"},d,e,f=function(){return e=d.pop()},g=function(){switch(e.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+e.depth+">"+b.lexer(e.text)+"</h"+e.depth+">\n";case"code":return"<pre><code"+(e.lang?' class="'+e.lang+'"':"")+">"+(e.escaped?e.text:j(e.text,!0))+"</code></pre>\n";case"blockquote_start":var a="";while(f().type!=="blockquote_end")a+=g();return"<blockquote>\n"+a+"</blockquote>\n";case"list_start":var c=e.ordered?"ol":"ul",a="";while(f().type!=="list_end")a+=g();return"<"+c+">\n"+a+"</"+c+">\n";case"list_item_start":var a="";while(f().type!=="list_item_end")a+=e.type==="text"?h():g();return"<li>"+a+"</li>\n";case"loose_item_start":var a="";while(f().type!=="list_item_end")a+=g();return"<li>"+a+"</li>\n";case"html":return p.sanitize?b.lexer(e.text):!e.pre&&!p.pedantic?b.lexer(e.text):e.text;case"paragraph":return"<p>"+b.lexer(e.text)+"</p>\n";case"text":return"<p>"+h()+"</p>\n"}},h=function(){var a=e.text,c;while((c=d[d.length-1])&&c.type==="text")a+="\n"+f().text;return b.lexer(a)},i=function(a){d=a.reverse();var b="";while(f())b+=g();return d=null,e=null,b},j=function(a,b){return a.replace(b?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},k=function(a){var b="",c=a.length,d=0,e;for(;d<c;d++)e=a.charCodeAt(d),Math.random()>.5&&(e="x"+e.toString(16)),b+="&#"+e+";";return b};n.exec=n;var o=function(b,c){return r(c),i(a.lexer(b))},p,q,r=function(c){c||(c=q);if(p===c)return;p=c,p.gfm?(a.fences=a.gfm.fences,a.paragraph=a.gfm.paragraph,b.text=b.gfm.text,b.url=b.gfm.url):(a.fences=a.normal.fences,a.paragraph=a.normal.paragraph,b.text=b.normal.text,b.url=b.normal.url),p.pedantic?(b.em=b.pedantic.em,b.strong=b.pedantic.strong):(b.em=b.normal.em,b.strong=b.normal.strong)};o.options=o.setOptions=function(a){q=a,r(a)},o.options({gfm:!0,pedantic:!1,sanitize:!1}),o.parser=function(a,b){return r(b),i(a)},o.lexer=function(b,c){return r(c),a.lexer(b)},o.parse=o,typeof module!="undefined"?module.exports=o:this.marked=o}).call(this),q.prototype.load=function(b){function E(a){for(var b=0;b<a.length;b++)a[b].style.width=c.element.offsetWidth-m+"px",a[b].style.height=c.element.offsetHeight-o+"px"}function F(b){if(Math.abs(s.y-b.pageY)>=5||Math.abs(s.x-b.pageX)>=5)q.style.display="block",r&&clearTimeout(r),r=a.setTimeout(function(){q.style.display="none"},1e3);s={y:b.pageY,x:b.pageX}}function G(a){a.keyCode==c.settings.shortcut.modifier&&(z=!0),a.keyCode==17&&(A=!0),z===!0&&a.keyCode==c.settings.shortcut.preview&&!c.eeState.fullscreen&&(a.preventDefault(),c.preview()),z===!0&&a.keyCode==c.settings.shortcut.edit&&(a.preventDefault(),c.eeState.fullscreen||c.edit()),z===!0&&a.keyCode==c.settings.shortcut.fullscreen&&(a.preventDefault(),w(y)),a.keyCode==27&&c.eeState.fullscreen&&(document.body.webkitRequestFullScreen||x(y)),A===!0&&a.keyCode==83&&a.preventDefault()}function H(a){a.keyCode==c.settings.shortcut.modifier&&(z=!1),a.keyCode==17&&(A=!1)}var c=this,j,l,m,o,p,q,r,s={y:-1,x:-1},t,u,v=document.body.webkitRequestFullScreen?!0:!1,w,x,y,z=!1,A=!1,B,C,D;b=b||function(){},c.eeState={fullscreen:!1,preview:!1,edit:!0},j={chrome:'<div id="epiceditor-wrapper" class="epiceditor-edit-mode"><iframe frameborder="0" id="epiceditor-editor-frame"></iframe><iframe frameborder="0" id="epiceditor-previewer-frame"></iframe><div class="epiceditor-utilbar"><img width="16" src="'+this.settings.basePath+'/images/preview.png" class="epiceditor-toggle-btn"> '+'<img width="16" src="'+this.settings.basePath+'/images/fullscreen.png" class="epiceditor-fullscreen-btn">'+"</div>"+"</div>",previewer:'<div class="epiceditor-preview"></div>'},c.element.innerHTML='<iframe scrolling="no" frameborder="0" id= "'+c.settings.id+'"></iframe>',l=document.getElementById(c.settings.id),c.iframeElement=l,c.iframe=k(l),c.iframe.open(),c.iframe.write(j.chrome),c.editorIframe=c.iframe.getElementById("epiceditor-editor-frame"),c.previewerIframe=c.iframe.getElementById("epiceditor-previewer-frame"),c.editorIframeDocument=k(c.editorIframe),c.editorIframeDocument.open(),c.editorIframeDocument.write(""),c.editorIframeDocument.close(),c.previewerIframeDocument=k(c.previewerIframe),c.previewerIframeDocument.open(),c.previewerIframeDocument.write(j.previewer),c.previewerIframeDocument.close(),m=g(c.element)-c.element.offsetWidth,o=h(c.element)-c.element.offsetHeight,E([c.iframeElement,c.editorIframe,c.previewerIframe]),i(c.settings.basePath+c.settings.theme.base,c.iframe),i(c.settings.basePath+c.settings.theme.editor,c.editorIframeDocument),i(c.settings.basePath+c.settings.theme.preview,c.previewerIframeDocument),c.iframe.getElementById("epiceditor-wrapper").style.position="relative",c.editor=c.editorIframeDocument.body,c.previewer=c.previewerIframeDocument.body.getElementsByClassName("epiceditor-preview")[0],c.editor.contentEditable=!0,c.iframe.body.style.height=this.element.offsetHeight+"px",this.previewerIframe.style.display="none",n()>-1&&(this.previewer.style.height=parseInt(e(this.previewer,"height"),10)+2),i(c.settings.basePath+c.settings.theme.preview,c.previewerIframeDocument,"theme"),this.open(c.settings.file.name),this.settings.focusOnLoad&&this.editor.focus(),c.iframe.getElementsByClassName("epiceditor-toggle-btn")[0].addEventListener("click",function(){c.eeState.edit?c.preview():c.edit()}),p=c.iframe.getElementsByClassName("epiceditor-utilbar")[0],t={},u=c.eeState.edit,w=function(b){v&&b.webkitRequestFullScreen(),c.eeState.fullscreen=!0,c.eeState.edit=!0,c.eeState.preview=!0;var d=a.innerWidth,g=a.innerHeight,h=a.outerWidth,i=a.outerHeight;v||(i=a.innerHeight),t.editorIframe=f(c.editorIframe,"save",{width:h/2+"px",height:i+"px","float":"left",cssFloat:"left",styleFloat:"left",display:"block"}),t.previewerIframe=f(c.previewerIframe,"save",{width:h/2+"px",height:i+"px","float":"right",cssFloat:"right",styleFloat:"right",display:"block"}),t.element=f(c.element,"save",{position:"fixed",top:"0",left:"0",width:"100%","z-index":"9999",zIndex:"9999",border:"none",background:e(c.editor,"background-color"),height:g+"px"}),t.iframeElement=f(c.iframeElement,"save",{width:h+"px",height:g+"px"}),p.style.visibility="hidden",v||(document.body.style.overflow="hidden"),c.preview(!0),c.editor.addEventListener("keyup",function(){c.preview(!0)})},x=function(a){f(c.element,"apply",t.element),f(c.iframeElement,"apply",t.iframeElement),f(c.editorIframe,"apply",t.editorIframe),f(c.previewerIframe,"apply",t.previewerIframe),p.style.visibility="visible",v||(document.body.style.overflow="auto"),c.eeState.fullscreen=!1,u?c.eeState.preview=!1:c.eeState.edit=!1},y=c.iframeElement,c.iframe.getElementsByClassName("epiceditor-fullscreen-btn")[0].addEventListener("click",function(){w(y)}),document.body.webkitRequestFullScreen&&y.addEventListener("webkitfullscreenchange",function(){document.webkitIsFullScreen||x(y)},!1),q=c.iframe.getElementsByClassName("epiceditor-utilbar")[0],q.style.display="none",B=[c.previewerIframeDocument,c.editorIframeDocument];for(D=0;D<B.length;D++)B[D].addEventListener("mousemove",function(a){F(a)}),B[D].addEventListener("keyup",function(a){H(a)}),B[D].addEventListener("keydown",function(a){G(a)});return c.settings.file.autoSave&&(C=a.setInterval(function(){c.content=this.value,c.save(c.settings.file.name,this.value)},c.settings.file.autoSave)),a.addEventListener("resize",function(){!c.iframe.webkitRequestFullScreen&&c.eeState.fullscreen&&(d(c.iframeElement,{width:a.outerWidth+"px",height:a.innerHeight+"px"}),d(c.element,{height:a.innerHeight+"px"}),d(c.previewerIframe,{width:a.outerWidth/2+"px",height:a.innerHeight+"px"}),d(c.editorIframe,{width:a.outerWidth/2+"px",height:a.innerHeight+"px"}))}),c.iframe.close(),b.call(this),this.emit("load"),this},q.prototype.unload=function(b){var c=this,d=a.parent.document.getElementById(c.settings.id);return d.parentNode.removeChild(d),b=b||function(){},b.call(this),c.emit("unload"),c},q.prototype.preview=function(a,b){var c=this,d=c.settings.basePath+c.settings.theme.preview;return typeof a=="boolean"?(b=a,a=d):a=a||d,j(c.getElement("wrapper"),"epiceditor-edit-mode","epiceditor-preview-mode"),c.previewerIframeDocument.getElementById("theme")?c.previewerIframeDocument.getElementById("theme").name!==a&&(c.previewerIframeDocument.getElementById("theme").href=a):i(a,c.previewerIframeDocument,"theme"),c.previewer.innerHTML=c.exportFile(null,"html"),b||(c.editorIframe.style.display="none",c.previewerIframe.style.display="block",c.eeState.preview=!0,c.eeState.edit=!1),c.emit("preview"),c},q.prototype.edit=function(){var a=this;return j(a.getElement("wrapper"),"epiceditor-preview-mode","epiceditor-edit-mode"),a.eeState.preview=!1,a.eeState.edit=!0,a.editorIframe.style.display="block",a.previewerIframe.style.display="none",a.emit("edit"),this},q.prototype.getElement=function(a){var b={container:this.element,wrapper:this.iframe.getElementById("epiceditor-wrapper"),wrapperIframe:this.iframeElement,editor:this.editorIframeDocument,editorIframe:this.editorIframe,previewer:this.previewerIframeDocument,previewerIframe:this.previewerIframe};return b[a]?b[a]:null},q.prototype.open=function(a){var b=this,c=b.settings.file.defaultContent,d;return a=a||b.settings.file.name,localStorage&&localStorage[b.settings.localStorageName]&&(d=JSON.parse(localStorage[b.settings.localStorageName]).files,d[a]?m(b.editor,d[a]):(m(b.editor,c),b.save()),b.settings.file.name=a,this.previewer.innerHTML=this.exportFile(null,"html"),this.emit("open")),this},q.prototype.save=function(a,b){var c=this,d;return a=a||c.settings.file.name,b=b||l(this.editor),d=JSON.parse(localStorage[c.settings.localStorageName]),d.files[a]=b,localStorage[c.settings.localStorageName]=JSON.stringify(d),this.emit("save"),this},q.prototype.remove=function(a){var b=this,c;return a=a||b.settings.file.name,c=JSON.parse(localStorage[b.settings.localStorageName]),delete c.files[a],localStorage[b.settings.localStorageName]=JSON.stringify(c),this.emit("remove"),this},q.prototype.rename=function(a,b){var c=this,d=JSON.parse(localStorage[c.settings.localStorageName]);return d.files[b]=d.files[a],delete d.files[a],localStorage[c.settings.localStorageName]=JSON.stringify(d),c.open(b),this},q.prototype.importFile=function(a,b,c,d){var e=this;return b=b||"",c=c||"md",d=d||{},e.settings.file.name=a,m(e.editor,b),e.save().open(a),this},q.prototype.exportFile=function(a,c){var d=this,e=localStorage[d.settings.localStorageName];a=a||d.settings.file.name,c=c||"text",e=JSON.parse(e).files[a];if(e===b)return;switch(c){case"html":return marked(e);case"text":return e;default:return e}},q.prototype.on=function(a,b){var c=this;return this.events[a]||(this.events[a]=[]),this.events[a].push(b),c},q.prototype.emit=function(a,b){function d(a){a.call(c,b)}var c=this;if(!this.events[a])return;return this.events[a].forEach(d),c},q.prototype.removeListener=function(a,b){var c=this;return b?this.events[a]?(this._events[a].splice(this._events[a].indexOf(b),1),c):c:(this.events[a]=[],c)},a.EpicEditor=q})(window);