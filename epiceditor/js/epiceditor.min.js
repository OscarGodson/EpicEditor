/**
 * Copyright (c) 2011 Oscar Godson http://oscargodson.com
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function (window, undefined) {//
// showdown.js -- A javascript port of Markdown.
//
// Copyright (c) 2007 John Fraser.
//
// Original Markdown Copyright (c) 2004-2005 John Gruber
//   <http://daringfireball.net/projects/markdown/>
//
// Redistributable under a BSD-style open source license.
// See license.txt for more information.
//
// The full source distribution is at:
//
//        A A L
//        T C A
//        T K B
//
//   <http://www.attacklab.net/>
//
// **************************************************
// GitHub Flavored Markdown modifications by Tekkub
// http://github.github.com/github-flavored-markdown/
//
// Modifications are tagged with "GFM"
// **************************************************
// **************************************************
// Node.JS port by Isaac Z. Schlueter
//
// Modifications are tagged with "isaacs"
// **************************************************
!({});var Showdown={};typeof exports=="object"&&(Showdown=exports,Showdown.parse=function(a,b){var c=new Showdown.converter;return c.makeHtml(a,b)});var GitHub;Showdown.converter=function(){var a,b,c,d=0;this.makeHtml=function(d,h){return typeof h!="undefined"&&(typeof h=="string"&&(h={nameWithOwner:h}),GitHub=h),a=new Array,b=new Array,c=new Array,d=d.replace(/~/g,"~T"),d=d.replace(/\$/g,"~D"),d=d.replace(/\r\n/g,"\n"),d=d.replace(/\r/g,"\n"),d="\n\n"+d+"\n\n",d=G(d),d=d.replace(/^[ \t]+$/mg,""),d=g(d),d=f(d),d=i(d),d=E(d),d=d.replace(/~D/g,"$$"),d=d.replace(/~T/g,"~"),d=d.replace(/https?\:\/\/[^"\s\<\>]*[^.,;'">\:\s\<\>\)\]\!]/g,function(a,b){var c=d.slice(0,b),e=d.slice(b);return c.match(/<[^>]+$/)&&e.match(/^[^>]*>/)?a:"<a target='blank' href='"+a+"'>"+a+"</a>"}),d=d.replace(/[a-z0-9_\-+=.]+@[a-z0-9\-]+(\.[a-z0-9-]+)+/ig,function(a){return"<a href='mailto:"+a+"'>"+a+"</a>"}),d=d.replace(/[a-f0-9]{40}/ig,function(a,b){if(typeof GitHub=="undefined"||typeof GitHub.nameWithOwner=="undefined")return a;var c=d.slice(0,b),e=d.slice(b);return c.match(/@$/)||c.match(/<[^>]+$/)&&e.match(/^[^>]*>/)?a:"<a target='blank' href='http://github.com/"+GitHub.nameWithOwner+"/commit/"+a+"'>"+a.substring(0,7)+"</a>"}),d=d.replace(/([a-z0-9_\-+=.]+)@([a-f0-9]{40})/ig,function(a,b,c,f){if(typeof GitHub=="undefined"||typeof GitHub.nameWithOwner=="undefined")return a;GitHub.repoName=GitHub.repoName||e();var g=d.slice(0,f),h=d.slice(f);return g.match(/\/$/)||g.match(/<[^>]+$/)&&h.match(/^[^>]*>/)?a:"<a target='blank' href='http://github.com/"+b+"/"+GitHub.repoName+"/commit/"+c+"'>"+b+"@"+c.substring(0,7)+"</a>"}),d=d.replace(/([a-z0-9_\-+=.]+\/[a-z0-9_\-+=.]+)@([a-f0-9]{40})/ig,function(a,b,c){return"<a target='blank' href='http://github.com/"+b+"/commit/"+c+"'>"+b+"@"+c.substring(0,7)+"</a>"}),d=d.replace(/#([0-9]+)/ig,function(a,b,c){if(typeof GitHub=="undefined"||typeof GitHub.nameWithOwner=="undefined")return a;var e=d.slice(0,c),f=d.slice(c);return e==""||e.match(/[a-z0-9_\-+=.]$/)||e.match(/<[^>]+$/)&&f.match(/^[^>]*>/)?a:"<a target='blank' href='http://github.com/"+GitHub.nameWithOwner+"/issues/#issue/"+b+"'>"+a+"</a>"}),d=d.replace(/([a-z0-9_\-+=.]+)#([0-9]+)/ig,function(a,b,c,f){if(typeof GitHub=="undefined"||typeof GitHub.nameWithOwner=="undefined")return a;GitHub.repoName=GitHub.repoName||e();var g=d.slice(0,f),h=d.slice(f);return g.match(/\/$/)||g.match(/<[^>]+$/)&&h.match(/^[^>]*>/)?a:"<a target='blank' href='http://github.com/"+b+"/"+GitHub.repoName+"/issues/#issue/"+c+"'>"+a+"</a>"}),d=d.replace(/([a-z0-9_\-+=.]+\/[a-z0-9_\-+=.]+)#([0-9]+)/ig,function(a,b,c){return"<a target='blank' href='http://github.com/"+b+"/issues/#issue/"+c+"'>"+a+"</a>"}),d};var e=function(){return GitHub.nameWithOwner.match(/^.+\/(.+)$/)[1]},f=function(c){var c=c.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,function(c,d,e,f,g){return d=d.toLowerCase(),a[d]=A(e),f?f+g:(g&&(b[d]=g.replace(/"/g,"&quot;")),"")});return c},g=function(a){a=a.replace(/\n/g,"\n\n");var b="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del",c="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math";return a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,h),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,h),a=a.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,h),a=a.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,h),a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,h),a=a.replace(/\n\n/g,"\n"),a},h=function(a,b){var d=b;return d=d.replace(/\n\n/g,"\n"),d=d.replace(/^\n/,""),d=d.replace(/\n+$/g,""),d="\n\n~K"+(c.push(d)-1)+"K\n\n",d},i=function(a){a=p(a);var b=u("<hr />");return a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,b),a=r(a),a=t(a),a=s(a),a=y(a),a=g(a),a=z(a),a},j=function(a){return a=v(a),a=k(a),a=B(a),a=n(a),a=l(a),a=C(a),a=A(a),a=x(a),a=a.replace(/  +\n/g," <br />\n"),a},k=function(a){var b=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return a=a.replace(b,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=H(b,"\\`*_"),b}),a},l=function(a){return a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,m),a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,m),a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,m),a},m=function(c,d,e,f,g,h,i,j){j==undefined&&(j="");var k=d,l=e,m=f.toLowerCase(),n=g,o=j;if(n==""){m==""&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m;if(a[m]!=undefined)n=a[m],b[m]!=undefined&&(o=b[m]);else{if(!(k.search(/\(\s*\)$/m)>-1))return k;n=""}}n=H(n,"*_");var p="<a target='blank' href=\""+n+'"';return o!=""&&(o=o.replace(/"/g,"&quot;"),o=H(o,"*_"),p+=' title="'+o+'"'),p+=">"+l+"</a>",p},n=function(a){return a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,o),a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,o),a},o=function(c,d,e,f,g,h,i,j){var k=d,l=e,m=f.toLowerCase(),n=g,o=j;o||(o="");if(n==""){m==""&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m;if(a[m]==undefined)return k;n=a[m],b[m]!=undefined&&(o=b[m])}l=l.replace(/"/g,"&quot;"),n=H(n,"*_");var p='<img src="'+n+'" alt="'+l+'"';return o=o.replace(/"/g,"&quot;"),o=H(o,"*_"),p+=' title="'+o+'"',p+=" />",p},p=function(a){return a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,b){return u("<h1>"+j(b)+"</h1>")}),a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,b){return u("<h2>"+j(b)+"</h2>")}),a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,b,c){var d=b.length;return u("<h"+d+">"+j(c)+"</h"+d+">")}),a},q,r=function(a){a+="~0";var b=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return d?a=a.replace(b,function(a,b,c){var d=b,e=c.search(/[*+-]/g)>-1?"ul":"ol";d=d.replace(/\n{2,}/g,"\n\n\n");var f=q(d);return f=f.replace(/\s+$/,""),f="<"+e+">"+f+"</"+e+">\n",f}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,b,c,d){var e=b,f=c,g=d.search(/[*+-]/g)>-1?"ul":"ol",f=f.replace(/\n{2,}/g,"\n\n\n"),h=q(f);return h=e+"<"+g+">\n"+h+"</"+g+">\n",h})),a=a.replace(/~0/,""),a};q=function(a){return d++,a=a.replace(/\n{2,}$/,"\n"),a+="~0",a=a.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(a,b,c,d,e){var f=e,g=b,h=c;return g||f.search(/\n{2,}/)>-1?f=i(F(f)):(f=r(F(f)),f=f.replace(/\n$/,""),f=j(f)),"<li>"+f+"</li>\n"}),a=a.replace(/~0/g,""),d--,a};var s=function(a){return a+="~0",a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){var d=b,e=c;return d=w(F(d)),d=G(d),d=d.replace(/^\n+/g,""),d=d.replace(/\n+$/g,""),d="<pre><code>"+d+"\n</code></pre>",u(d)+e}),a=a.replace(/~0/,""),a},t=function(a){return a=a.replace(/`{3}(?:(.*$)\n)?([\s\S]*?)`{3}/gm,function(a,b,c){var d='<div class="highlight"><pre lang="'+b+'">'+c+"</pre></div>";return d}),a},u=function(a){return a=a.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(c.push(a)-1)+"K\n\n"},v=function(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d,e){var f=d;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=w(f),b+"<code>"+f+"</code>"}),a},w=function(a){return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=H(a,"*_{}[]\\",!1),a},x=function(a){return a=a.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),a=a.replace(/(\w)_(\w)/g,"$1~E95E$2"),a=a.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>"),a},y=function(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c=b;return c=c.replace(/^[ \t]*>[ \t]?/gm,"~0"),c=c.replace(/~0/g,""),c=c.replace(/^[ \t]+$/gm,""),c=i(c),c=c.replace(/(^|\n)/g,"$1  "),c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c=b;return c=c.replace(/^  /mg,"~0"),c=c.replace(/~0/g,""),c}),u("<blockquote>\n"+c+"\n</blockquote>")}),a},z=function(a){a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");var b=a.split(/\n{2,}/g),d=new Array,e=b.length;for(var f=0;f<e;f++){var g=b[f];g.search(/~K(\d+)K/g)>=0?d.push(g):g.search(/\S/)>=0&&(g=j(g),g=g.replace(/\n/g,"<br />"),g=g.replace(/^([ \t]*)/g,"<p>"),g+="</p>",d.push(g))}e=d.length;for(var f=0;f<e;f++)while(d[f].search(/~K(\d+)K/)>=0){var h=c[RegExp.$1];h=h.replace(/\$/g,"$$$$"),d[f]=d[f].replace(/~K\d+K/,h)}return d.join("\n\n")},A=function(a){return a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;"),a},B=function(a){return a=a.replace(/\\(\\)/g,I),a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,I),a},C=function(a){return a=a.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,"<a target='blank' href=\"$1\">$1</a>"),a=a.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(a,b){return D(E(b))}),a},D=function(a){function b(a){var b="0123456789ABCDEF",c=a.charCodeAt(0);return b.charAt(c>>4)+b.charAt(c&15)}var c=[function(a){return"&#"+a.charCodeAt(0)+";"},function(a){return"&#x"+b(a)+";"},function(a){return a}];return a="mailto:"+a,a=a.replace(/./g,function(a){if(a=="@")a=c[Math.floor(Math.random()*2)](a);else if(a!=":"){var b=Math.random();a=b>.9?c[2](a):b>.45?c[1](a):c[0](a)}return a}),a="<a target='blank' href=\""+a+'">'+a+"</a>",a=a.replace(/">.+:/g,'">'),a},E=function(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)}),a},F=function(a){return a=a.replace(/^(\t|[ ]{1,4})/gm,"~0"),a=a.replace(/~0/g,""),a},G=function(a){return a=a.replace(/\t(?=\t)/g,"    "),a=a.replace(/\t/g,"~A~B"),a=a.replace(/~B(.+?)~A/g,function(a,b,c){var d=b,e=4-d.length%4;for(var f=0;f<e;f++)d+=" ";return d}),a=a.replace(/~A/g,"    "),a=a.replace(/~B/g,""),a},H=function(a,b,c){var d="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(d="\\\\"+d);var e=new RegExp(d,"g");return a=a.replace(e,I),a},I=function(a,b){var c=b.charCodeAt(0);return"~E"+c+"E"}};//Fullscreen API wrapper ( http://johndyer.name/native-fullscreen-javascript-api-plus-jquery-plugin/ )
(function(){var a,b,c={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},d="webkit moz o ms khtml".split(" ");if("undefined"!=typeof document.cancelFullScreen)c.supportsFullScreen=!0;else for(a=0,b=d.length;a<b;a++)if(c.prefix=d[a],"undefined"!=typeof document[c.prefix+"CancelFullScreen"]){c.supportsFullScreen=!0;break}c.supportsFullScreen&&(c.fullScreenEventName=c.prefix+"fullscreenchange",c.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},c.requestFullScreen=function(a){return""===this.prefix?a.requestFullScreen():a[this.prefix+"RequestFullScreen"]()},c.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}),"undefined"!=typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){c.supportsFullScreen&&c.requestFullScreen(this)})}),window.fullScreenApi=c})();function _applyAttrs(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function _getStyle(a,b){var c=a,d=null;return window.getComputedStyle?d=document.defaultView.getComputedStyle(c,null).getPropertyValue(b):c.currentStyle&&(d=c.currentStyle[b]),d}function _outerWidth(a){var b=parseInt(_getStyle(a,"border-left-width"),10)+parseInt(_getStyle(a,"border-right-width"),10),c=parseInt(_getStyle(a,"padding-left"),10)+parseInt(_getStyle(a,"padding-right"),10),d=a.offsetWidth,e;return isNaN(b)&&(b=0),e=b+c+d,e}function _outerHeight(a){var b=parseInt(_getStyle(a,"border-top-width"),10)+parseInt(_getStyle(a,"border-bottom-width"),10),c=parseInt(_getStyle(a,"padding-top"),10)+parseInt(_getStyle(a,"padding-bottom"),10),d=a.offsetHeight,e;return isNaN(b)&&(b=0),e=b+c+d,e}function _insertCSSLink(a,b,c){var d=b.getElementsByTagName("head")[0],e=b.createElement("link");c=c||"",_applyAttrs(e,{type:"text/css",id:c,rel:"stylesheet",href:a+"?"+(new Date).getTime(),name:a,media:"screen"}),e.media="screen",d.appendChild(e)}function _replaceClass(a,b,c){a.className=a.className.replace(b,c)}function _isIE(){var a=-1,b,c;return navigator.appName==="Microsoft Internet Explorer"&&(b=navigator.userAgent,c=/MSIE ([0-9]{1,}[\.0-9]{0,})/,c.exec(b)!==null&&(a=parseFloat(RegExp.$1))),a}function _mergeObjs(){function i(a){var b={};return a&&b.toString.call(a)==="[object Function]"}var a=arguments[0]||{},b=1,c=arguments.length,d=!1,e,f,g,h;typeof a=="boolean"&&(d=a,a=arguments[1]||{},b=2),typeof a!="object"&&!i(a)&&(a={}),c===b&&(a=this,--b);for(;b<c;b++){e=arguments[b];if(e!==null&&e!==undefined)for(f in e)if(e.hasOwnProperty(f)){g=a[f],h=e[f];if(a===h)continue;d&&h&&typeof h=="object"&&!h.nodeType?a[f]=_mergeObjs(d,g||(h.length!==null&&h.length!==undefined?[]:{}),h):h!==undefined&&(a[f]=h)}}return a}function EpicEditor(a){var b="epiceditor-"+Math.round(Math.random()*1e5),c=a.id,d;return c||(c="default"),this.settings={basePath:"epiceditor",themes:{preview:"/themes/preview/preview-dark.css",editor:"/themes/editor/epic-dark.css"},file:{name:c,defaultContent:""},id:b,focusOnLoad:!1,shortcuts:{modifier:18,fullscreen:70,preview:80,edit:79}},localStorage&&(localStorage.epiceditor?JSON.parse(localStorage.epiceditor).files[this.settings.file.name]?this.content=this.settings.file.defaultContent:JSON.parse(localStorage.epiceditor).files[this.settings.file.name]=this.settings.file.defaultContent:(d={files:{}},d.files[this.settings.file.name]=this.settings.file.defaultContent,d=JSON.stringify(d),localStorage.epiceditor=d)),this.events||(this.events={}),this.element=a,this}EpicEditor.prototype.options=function(a){var b=this;return b.settings=_mergeObjs(!0,this.settings,a),b},EpicEditor.prototype.load=function(a){var b=this,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;return a=a||function(){},c='<div class="epiceditor-wrapper epiceditor-edit-mode"><div class="epiceditor-utilbar"><img width="16" src="'+this.settings.basePath+'/images/preview.png" class="epiceditor-toggle-btn"> '+'<img width="16" src="'+this.settings.basePath+'/images/fullscreen.png" class="epiceditor-fullscreen-btn">'+"</div>"+'<div class="epiceditor-editor">'+'<textarea class="epiceditor-textarea"></textarea>'+"</div>"+'<div class="epiceditor-preview"></div>'+"</div>",this.element.innerHTML='<iframe scrolling="no" frameborder="0" id= "'+b.settings.id+'"></iframe>',d=document.getElementById(b.settings.id),b.iframe=d.contentDocument||d.contentWindow.document,b.iframe.open(),b.iframe.write(c),f=_outerWidth(this.element)-this.element.offsetWidth,g=_outerHeight(this.element)-this.element.offsetHeight,d.style.width=this.element.offsetWidth-f+"px",d.style.height=this.element.offsetHeight-g+"px",e=b.iframe.body,e.style.padding="0",e.style.margin="0",_insertCSSLink(b.settings.basePath+b.settings.themes.editor,b.iframe),b.iframe.getElementsByClassName("epiceditor-wrapper")[0].style.position="relative",this.editor=b.iframe.getElementsByClassName("epiceditor-textarea")[0],this.previewer=b.iframe.getElementsByClassName("epiceditor-preview")[0],b.iframe.body.style.height=this.element.offsetHeight+"px",this.editor.style.width="100%",this.editor.style.height=this.element.offsetHeight+"px",this.previewer.style.display="none",this.previewer.style.overflow="auto",this.previewer.style.padding="10px",this.previewer.style.width=this.element.offsetWidth-_outerWidth(this.previewer)-f+"px",this.previewer.style.height=this.element.offsetHeight-_outerHeight(this.previewer)-g+"px",_isIE()>-1&&(this.previewer.style.height=parseInt(_getStyle(this.previewer,"height"),10)+2),_insertCSSLink(b.settings.basePath+b.settings.themes.preview,b.iframe,"theme"),this.open(b.settings.file.name),this.settings.focusOnLoad&&this.editor.focus(),b.iframe.getElementsByClassName("epiceditor-toggle-btn")[0].addEventListener("click",function(){b.get("wrapper").className.indexOf("epiceditor-edit-mode")>-1?b.preview():b.edit()}),fullScreenApi.supportsFullScreen&&document.body.webkitRequestFullScreen?(h=document.getElementById(b.settings.id),i=b.iframe.getElementsByClassName("epiceditor-utilbar")[0],j=[],k=function(a,b){var c;b=b||"load";if(b==="save")j[a]={width:_getStyle(a,"width"),height:_getStyle(a,"height"),"float":_getStyle(a,"float"),display:_getStyle(a,"display")};else for(c in j[a])j[a].hasOwnProperty(c)&&(a.style[c]=j[a][c])},k(b.editor,"save"),k(b.previewer,"save"),l=b.editor,b.iframe.getElementsByClassName("epiceditor-fullscreen-btn")[0].addEventListener("click",function(){_getStyle(b.previewer,"display")==="block"&&(l=b.previewer),fullScreenApi.requestFullScreen(h)}),h.addEventListener(fullScreenApi.fullScreenEventName,function(){fullScreenApi.isFullScreen()?(i.style.visibility="hidden",b.editor.style.height=window.outerHeight+"px",b.editor.style.width=window.outerWidth/2+"px",b.editor.style.float="left",b.editor.style.display="block",b.previewer.style.height=window.outerHeight+"px",b.previewer.style.width=window.outerWidth-_outerWidth(b.editor)+"px",b.previewer.style.float="right",b.previewer.style.display="block",b.preview(!0),q=b.editor.addEventListener("keyup",function(){b.preview(!0)})):(i.style.visibility="visible",k(b.editor),k(b.previewer),l===b.editor?b.edit():b.preview())},!0)):b.iframe.getElementsByClassName("epiceditor-fullscreen-btn")[0].style.display="none",m=b.iframe.getElementsByClassName("epiceditor-utilbar")[0],m.style.display="none",o={y:-1,x:-1},this.iframe.addEventListener("mousemove",function(a){if(Math.abs(o.y-a.pageY)>=5||Math.abs(o.x-a.pageX)>=5)m.style.display="block",n&&clearTimeout(n),n=window.setTimeout(function(){m.style.display="none"},1e3);o={y:a.pageY,x:a.pageX}}),window.addEventListener("resize",function(){var a=_outerWidth(b.element)-b.element.offsetWidth;d.style.width=b.element.offsetWidth-a+"px"}),b.editor.addEventListener("keyup",function(){b.content=this.value,b.save(b.settings.file.name,this.value)}),p=!1,b.iframe.addEventListener("keyup",function(a){a.keyCode===b.settings.shortcuts.modifier&&(p=!1)}),b.iframe.addEventListener("keydown",function(a){a.keyCode===b.settings.shortcuts.modifier&&(p=!0),p===!0&&a.keyCode===b.settings.shortcuts.preview&&!fullScreenApi.isFullScreen()&&(a.preventDefault(),b.preview()),p===!0&&a.keyCode===b.settings.shortcuts.edit&&(a.preventDefault(),fullScreenApi.isFullScreen()||b.edit()),p===!0&&a.keyCode===b.settings.shortcuts.fullscreen&&(a.preventDefault(),document.body.webkitRequestFullScreen&&fullScreenApi.requestFullScreen(h))}),b.iframe.close(),a.call(this),this.emit("load"),this},EpicEditor.prototype.unload=function(a){var b=this,c=window.parent.document.getElementById(b.settings.id);return c.parentNode.removeChild(c),a.call(this),b.emit("unload"),b},EpicEditor.prototype.preview=function(a,b){var c=this,d=c.settings.basePath+c.settings.themes.preview;return typeof a=="boolean"?(b=a,a=d):a=a||d,_replaceClass(c.get("wrapper"),"epiceditor-edit-mode","epiceditor-preview-mode"),c.iframe.getElementById("theme")?c.iframe.getElementById("theme").name!==a&&(c.iframe.getElementById("theme").href=a):_insertCSSLink(a,c.iframe,"theme"),this.previewer.innerHTML=this.exportHTML(),b||(this.editor.style.display="none",this.previewer.style.display="block"),c.emit("preview"),this},EpicEditor.prototype.edit=function(){var a=this;return _replaceClass(a.get("wrapper"),"epiceditor-preview-mode","epiceditor-edit-mode"),this.editor.style.display="block",this.previewer.style.display="none",a.emit("edit"),this},EpicEditor.prototype.get=function(a){var b={document:this.iframe,body:this.iframe.body,editor:this.editor,previewer:this.previewer,wrapper:this.iframe.getElementsByClassName("epiceditor-wrapper")[0]};return b[a]?b[a]:null},EpicEditor.prototype.open=function(a){var b=this,c;return a=a||b.settings.file.name,localStorage&&localStorage.epiceditor&&(c=JSON.parse(localStorage.epiceditor).files,c[a]?b.editor.value=c[a]:b.editor.value=this.settings.file.defaultContent,b.settings.file.name=a,this.previewer.innerHTML=this.exportHTML(),this.emit("open")),this},EpicEditor.prototype.save=function(a,b){var c=this,d;return a=a||c.settings.file.name,b=b||this.editor.value,d=JSON.parse(localStorage.epiceditor),d.files[a]=b,localStorage.epiceditor=JSON.stringify(d),this.emit("save"),this},EpicEditor.prototype.remove=function(a){var b=this,c;return a=a||b.settings.file.name,c=JSON.parse(localStorage.epiceditor),delete c.files[a],localStorage.epiceditor=JSON.stringify(c),this.emit("remove"),this},EpicEditor.prototype.import=function(a,b){var c=this;return b=b||"",c.open(a).get("editor").value=b,c.save().open(a),this},EpicEditor.prototype.rename=function(a,b){var c=this,d=JSON.parse(localStorage.epiceditor);return d.files[b]=d.files[a],delete d.files[a],localStorage.epiceditor=JSON.stringify(d),c.open(b),this},EpicEditor.prototype.exportHTML=function(){var a=new Showdown.converter;return a.makeHtml(this.editor.value)},EpicEditor.prototype.on=function(a,b){var c=this;return this.events[a]||(this.events[a]=[]),this.events[a].push(b),c},EpicEditor.prototype.emit=function(a,b){function d(a){a.call(c.iframe,b)}var c=this;if(!this.events[a])return;return this.events[a].forEach(d),c},EpicEditor.prototype.removeListener=function(a,b){var c=this;return b?this.events[a]?(this._events[a].splice(this._events[a].indexOf(b),1),c):c:(this.events[a]=[],c)},window.EpicEditor=EpicEditor;})(window);